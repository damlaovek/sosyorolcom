{% load static %}
{% load index %}
{% include 'includes/general/head.html' %}
        <title>Sosyorol - Sosyal İçerik Platformu</title>
        <link rel="stylesheet" href="{% static 'css/left-menu-v2.css' %}">
        <link rel="stylesheet" href="{% static 'css/right-menu-v9.css' %}">
        <link rel="stylesheet" href="{% static 'css/feed-v42.css' %}">
        <link rel="stylesheet" href="{% static 'css/answer-template-v9.css' %}">
        <link rel="stylesheet" href="{% static 'css/comments-v1.css' %}">
        <script src="{% static 'js/new/autosize.min.js' %}"></script>
        <script src="{% static 'js/sosyorol.min.js' %}"></script>
        <script src="{% static 'js/index.js' %}"></script>
        <script>
            function checkViewsCookie(){
                var url = window.location.href;
                var cookie_value=getCookie("views_count_homepage");
                if (cookie_value == "") {
                    //setCookie("views_count_homepage", user, 30);
                }
            }
        </script>
    </head>
    <body class="{{darkmode}}" onload="checkViewsCookie()">
        {% include 'includes/general/header.html' %}
        {% include 'includes/general/lang_popup.html' %}
        <div class="full-width inline-flex">
            {% include 'includes/general/left_menu.html' %}
            <div class="section-middle" style="margin-top:45px; padding-bottom:32px;">
                <div class="bsbb p2040">
                    <div class="box full-shadow">
                        <div class="bsbb p20 full-width bb">
                            <div class="inline-flex full-width">
                                <img src="{{current_user.avatar_url}}" class="rounded sqr40" id="profileImg"/>
                                <div class="ml10">
                                    <p class="fwbold lh20">u/{{current_user.user_login}}</p>
                                    <p class="hand cb fwmedium lh20 underline-on-hover">{{word_list|getword:"change_profile_picture"|ucwords}}</p>
                                    <input type='file' onchange="changeProfilePicture(this, {% url 'changeprofilepicture' %});" class="hand absolute aligntl full-width" style="height:40px;overflow:hidden;opacity:0;z-index:6;" id="profileUpload" name="file" accept=".png, .jpg, .jpeg" />
                                </div>
                            </div>
                        </div>
                        <div class="bsbb p20 full-width">
                            <form class="bsbb full-width p10">
                                <input type="hidden" name="current_uname" id="current_uname" value="{{current_user.user_login}}">
                                <div class="full-width inline-flex">
                                    <label for="fullname" class="lh40" style="width:35%;">{{word_list|getword:"name"|ucfirst}}:</label><input type="text" class="bsbb p10 border br4 cg2 fwbold" style="width:65%;" name="fullname" id="fullname" placeholder="" onkeyup="validateAccountSettings()" value="{{current_user.display_name}}">
                                </div>
                                <div class="full-width mt10 inline-flex">
                                    <label for="username" class="lh40" style="width:35%;">{{word_list|getword:"username"|ucfirst}}:</label><input type="text" class="bsbb p10 border br4 cg2 fwbold" style="width:65%;" name="username" id="username" placeholder="" onkeyup="validateAccountSettings()" value="{{current_user.user_login}}">
                                </div>
                                <div class="full-width mt10 inline-flex">
                                    <label for="website" class="lh40" style="width:35%;">{{word_list|getword:"website"|ucfirst}}:</label><input type="text" class="bsbb p10 border br4 cg2 fwbold" style="width:65%;" name="website" id="website" placeholder='{{word_list|getword:"website"|ucfirst}}' onkeyup="validateAccountSettings()" value="{{current_user.website}}">
                                </div>
                                <div class="full-width mt10 inline-flex">
                                    <label for="profiledesc" class="lh40" style="width:35%;">{{word_list|getword:"description"|ucfirst}}:</label><br>
                                    <textarea rows="5" class="bsbb p10 border br4 cg2 fwbold bcw textarea" style="width:65%;background-color: var(--white);" name="profiledesc" id="profiledesc" onkeyup="">{% autoescape off %}{{current_user.description|edit_comm_desc}}{% endautoescape %}</textarea>
                                </div>
                                <div class="full-width mt10 inline-flex">
                                    <label for="phone" class="lh40" style="width:35%;">{{word_list|getword:"phone_number"|ucwords}}:</label><input type="tel" class="bsbb p10 border br4 cg2 fwbold" style="width:65%;" name="phone" id="phone" placeholder='{{word_list|getword:"phone_number"|ucwords}}' onkeyup="validateAccountSettings()">
                                </div>
                                <div class="full-width inline-flex mt10">
                                    <label for="gender" class="lh40" style="width:35%;">{{word_list|getword:"gender"|ucfirst}}:</label>
                                    <input type="text" class="bsbb p10 border br4 cg2 fwbold" style="width:65%;" name="gender" id="gender" placeholder='{{word_list|getword:"gender"|ucfirst}}' onfocus="document.getElementById('gender-list').classList.remove('dnone');" readonly>
                                    <div class="absolute full-width alignbr dnone" style="top:40px;width:65%;background-color:var(--white); z-index:100;" id="gender-list">
                                        <ul id="lang_results_container" class="full-width full-shadow2" style="border:1px solid var(--main-color); width:calc(100% - 2px); max-height:400px; overflow-y: scroll; background-color: var(--white); z-index:100;">
                                            <li class="p1020 hand bb cg2" onmouseover="this.classList.remove('cg2');this.classList.add('cb');" onmouseout="this.classList.remove('cb');this.classList.add('cg2');" onclick="document.getElementById('gender').value=this.innerText;document.getElementById('gender-list').classList.add('dnone');validateAccountSettings();">Kadın</li>
                                            <li class="p1020 hand bb cg2" onmouseover="this.classList.remove('cg2');this.classList.add('cb');" onmouseout="this.classList.remove('cb');this.classList.add('cg2');" onclick="document.getElementById('gender').value=this.innerText;document.getElementById('gender-list').classList.add('dnone');validateAccountSettings();">Erkek</li>
                                            <li class="p1020 hand cg2" onmouseover="this.classList.remove('cg2');this.classList.add('cb');" onmouseout="this.classList.remove('cb');this.classList.add('cg2');" onclick="document.getElementById('gender').value=this.innerText;document.getElementById('gender-list').classList.add('dnone');validateAccountSettings();">Belirtmek istemiyorum</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="mt20 full-width inline-block">
                                    <input disabled type="submit" id="save-account-settings" class="btn p10 right fs15 lh20 noselect" style="border-radius:4px;height:30px;width:calc(25% - 35px); border:none; text-align:center; color:var(--main-color); font-weight:700;opacity:0.8" value="{{word_list|getword:'save'|ucfirst}}" onclick="return false;"/>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="section-right fixed" id="section-right">
                <ul class="bsbb w64 nav p400 m034">
                    <div class="filter-options">
                        <div class='bsbb full-width mb20 ml10 oh w68'>
                            <p class='title fs19'>{{word_list|getword:'settings'|ucwords}}</p>
                        </div>
                    </div>
                    <div class="full-width">
                        <a href="/settings" class="full-width">
                            <div class="full-width hand">
                                <li class="left-list-item p510 bcb">
                                    <div class="bgb rounded" style="width:30px;height:30px;padding:5px;border-radius:50%;">
                                        <svg width="20pt" height="20pt" viewBox="0 0 20 20" style="margin-left:5px; margin-top:3px;">
                                            <g>
                                                <path style=" stroke:none;fill:white;fill-rule:nonzero;fill-opacity:1;" d="M 0.601562 14.574219 L 14.398438 14.574219 C 14.582031 14.574219 14.753906 14.5 14.871094 14.367188 C 14.96875 14.253906 15.015625 14.109375 14.996094 13.960938 C 14.671875 11.441406 13.121094 9.339844 11 8.222656 C 10.101562 9.117188 8.867188 9.671875 7.5 9.671875 C 6.132812 9.671875 4.898438 9.117188 4 8.222656 C 1.878906 9.339844 0.328125 11.441406 0.00390625 13.960938 C -0.015625 14.109375 0.03125 14.253906 0.128906 14.367188 C 0.246094 14.5 0.417969 14.574219 0.601562 14.574219 Z M 0.601562 14.574219 "/>
                                                <path style=" stroke:none;fill:white;fill-rule:nonzero;fill-opacity:1;" d="M 4.390625 7.675781 C 4.472656 7.761719 4.554688 7.839844 4.640625 7.917969 C 5.402344 8.597656 6.402344 9.015625 7.5 9.015625 C 8.597656 9.015625 9.597656 8.597656 10.355469 7.917969 C 10.445312 7.839844 10.527344 7.761719 10.609375 7.675781 C 10.6875 7.589844 10.765625 7.503906 10.839844 7.414062 C 11.4375 6.675781 11.796875 5.742188 11.796875 4.722656 C 11.796875 2.351562 9.867188 0.425781 7.5 0.425781 C 5.132812 0.425781 3.203125 2.351562 3.203125 4.722656 C 3.203125 5.742188 3.5625 6.675781 4.160156 7.414062 C 4.230469 7.503906 4.308594 7.589844 4.390625 7.675781 Z M 4.390625 7.675781 "/>
                                            </g>
                                        </svg>
                                    </div>
                                    <p class="ellipsis followed-community-name fs19" style="padding:0 15px;font-weight:var(--bold);line-height:40px;color:white;">{{word_list|getword:"account"|ucfirst}}</p>
                                </li>
                            </div>
                        </a>
                    </div>
                    <div class="full-width">
                        <a href="/settings/privacy" class="full-width">
                            <div class="full-width hand left-list-item-link">
                                <li class="left-list-item p510">
                                    <div class="bgb rounded" style="width:30px;height:30px;padding:5px;border-radius:50%;">
                                        <svg width="20pt" height="20pt" viewBox="0 0 20 20" style="margin-left:2px;margin-top:1px;">
                                            <g>
                                                <path style=" stroke:none;fill-rule:nonzero;fill:white;fill-opacity:1;" d="M 6.914062 5.9375 L 6.914062 4.363281 C 6.914062 2.660156 8.300781 1.277344 10 1.277344 C 11.699219 1.277344 13.085938 2.660156 13.085938 4.363281 L 13.085938 5.9375 C 13.09375 5.941406 13.097656 5.945312 13.105469 5.945312 C 13.546875 6.132812 13.964844 6.355469 14.363281 6.617188 L 14.363281 4.363281 C 14.363281 1.957031 12.40625 0 10 0 C 7.59375 0 5.636719 1.957031 5.636719 4.363281 L 5.636719 6.617188 C 6.035156 6.355469 6.453125 6.132812 6.894531 5.945312 C 6.902344 5.945312 6.90625 5.941406 6.914062 5.9375 Z M 6.914062 5.9375 "/>
                                                <path style=" stroke:none;fill-rule:nonzero;fill:white;fill-opacity:1;" d="M 10 6.597656 C 6.296875 6.597656 3.296875 9.597656 3.296875 13.296875 C 3.296875 17 6.296875 20 10 20 C 13.703125 20 16.703125 17 16.703125 13.296875 C 16.703125 9.597656 13.703125 6.597656 10 6.597656 Z M 9.46875 15.617188 L 6.96875 13.117188 L 7.871094 12.214844 L 9.46875 13.8125 L 11.855469 11.429688 L 12.757812 12.332031 Z M 9.46875 15.617188 "/>
                                            </g>
                                        </svg>
                                    </div>
                                    <p class="ellipsis followed-community-name fs19" style="padding:0 15px;font-weight:var(--bold);line-height:40px;">{{word_list|getword:"privacy"|ucfirst}}</p>
                                </li>
                            </div>
                        </a>
                    </div>
                    <div class="full-width">
                        <a href="/settings/notifications" class="full-width">
                            <div class="full-width hand left-list-item-link">
                                <li class="left-list-item p510">
                                    <div class="bgb rounded" style="width:30px;height:30px;padding:5px;border-radius:50%;">
                                        <svg width="20pt" height="20pt" viewBox="0 0 20 20" style="margin-left:5px; margin-top:5px;">
                                            <g>
                                                <path style=" stroke:none;fill-rule:nonzero;fill:white;fill-opacity:1;" d="M 12.757812 9.335938 L 12.757812 6.308594 C 12.75 3.972656 11.148438 1.742188 8.753906 1.175781 C 8.753906 1.175781 8.675781 0 7.5 0 C 6.304688 0 6.246094 1.144531 6.246094 1.144531 C 3.851562 1.707031 2.269531 3.972656 2.257812 6.308594 L 2.257812 9.238281 C 2.257812 10.671875 1.316406 10.917969 0.199219 12.082031 L 14.800781 12.082031 C 13.683594 10.917969 12.757812 10.765625 12.757812 9.335938 Z M 7.5 15 C 8.78125 15 9.855469 13.976562 10.144531 12.664062 L 4.855469 12.664062 C 5.144531 13.976562 6.21875 15 7.5 15 Z M 7.5 15 "/>
                                            </g>
                                        </svg>
                                    </div>
                                    <p class="ellipsis followed-community-name fs19" style="padding:0 15px;font-weight:var(--bold);line-height:40px;">{{word_list|getword:"notifications"|ucfirst}}</p>
                                </li>
                            </div>
                        </a>
                    </div>
                    <div class="full-width">
                        <a href="/settings/feed" class="full-width">
                            <div class="full-width hand left-list-item-link">
                                <li class="left-list-item p510">
                                    <div class="bgb rounded" style="width:30px;height:30px;padding:5px;border-radius:50%;">
                                        <p class="non-draggable rounded background-image" id="home-icon" style="margin-left:-5px;margin-top:-5px;"></p>
                                    </div>
                                    <p class="ellipsis followed-community-name fs19" style="padding:0 15px;font-weight:var(--bold);line-height:40px;">{{word_list|getword:"feed"|ucfirst}}</p>
                                </li>
                            </div>
                        </a>
                    </div>
                    <div class="full-width">
                        <a href="/settings/chat" class="full-width">
                            <div class="full-width hand left-list-item-link">
                                <li class="left-list-item p510">
                                    <div class="bgb rounded" style="width:30px;height:30px;padding:5px;border-radius:50%;">
                                        <svg width="20pt" height="20pt" viewBox="0 0 20 20" style="margin-left:5px; margin-top:5px;">
                                            <g>
                                                <path style=" stroke:none;fill:white;fill-rule:nonzero;fill-opacity:1;" d="M 15 6.515625 C 15 9.703125 11.929688 12.316406 8.039062 12.542969 C 5.738281 14.085938 2.300781 14.527344 2.300781 14.527344 C 2.300781 14.527344 3.152344 13.304688 3.417969 11.582031 C 1.359375 10.503906 0 8.636719 0 6.515625 C 0 3.175781 3.359375 0.472656 7.5 0.472656 C 11.640625 0.472656 15 3.175781 15 6.515625 Z M 15 6.515625 "/>
                                            </g>
                                        </svg>
                                    </div>
                                    <p class="ellipsis followed-community-name fs19" style="padding:0 15px;font-weight:var(--bold);line-height:40px;">{{word_list|getword:"chat"|ucfirst}}</p>
                                </li>
                            </div>
                        </a>
                    </div>
                </ul>
            </div>
        </div>
        {% include 'includes/general/chat_popup.html' %}
        <script>
            window.onload = function(){
                var popup = document.getElementById('gender-list');
                var openButton = document.getElementById('gender');
                document.onclick = function(e){
                    if(e.target === openButton || e.target === popup){
                        popup.classList.remove("dnone");
                    }else{
                        popup.classList.add("dnone");
                    }
                };
            };
            function validateAccountSettings(){
                var username = document.getElementById("username");
                var phonenumber = document.getElementById("phone");
                if(!validateUsername(username.value)){
                    document.getElementById("save-account-settings").disabled = true;
                    document.getElementById("save-account-settings").style.opacity = "0.8";
                    document.getElementById("save-account-settings").style.cursor = "default";
                    return false
                }
                if(phone.value != ""){
                    if(!validatePhonenumber(phone)){
                        document.getElementById("save-account-settings").disabled = true;
                        document.getElementById("save-account-settings").style.opacity = "0.8";
                        document.getElementById("save-account-settings").style.cursor = "default";
                        return false
                    }
                }
                document.getElementById("save-account-settings").disabled = false;
                document.getElementById("save-account-settings").style.opacity = "1";
                document.getElementById("save-account-settings").style.cursor = "pointer";
                return true;
            }
            function validateUsername(username){
                if(username == ""){
                    alert("empty username");
                    return false;
                }else{
                    var current_uname = document.getElementById("current_uname").value;
                    if(username != current_uname){
                        var data = {"username": username}
                        jQuery.ajax({
                            type: "POST",
                            url:"{% url 'checkusernameexists' %}",
                            data: data,
                            success: function(response) {
                                if(response.content == "{{word_list|getword:'username-already-exists'}}"){
                                    displayAlert(response.content);
                                    return false;
                                }else if(response.content == "error"){
                                    return false;
                                }
                            }
                        });
                    }
                }
                return true;
            }
            function changeProfilePicture(input, url){
                var placeholder = document.getElementById("profileImg");
                if (input.files && input.files[0]) {
                    var fd = new FormData();
                    var files = input.files[0];
                    var fullPath = input.value;
                    if (fullPath) {
                        var startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
                        var filename = fullPath.substring(startIndex);
                        if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
                            filename = filename.substring(1);
                            var tokens = filename.split(".");
                            if (tokens[0].length > 96) {
                                tokens[0] = tokens[0].substring(0,95);
                                filename = tokens[0].concat(tokens[1]);
                            }
                        }
                    }
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        placeholder.src = e.target.result;
                        placeholder.style.opacity = "1";
                    }
                    reader.readAsDataURL(input.files[0]);
                    fd.append('file',files,filename);
                    j.ajax({
                        type: "POST",
                        url: url,
                        data: fd,
                        processData: false, 
                        contentType: false,
                        success: function(response) {
                            if(response.is_valid){
                                displayAlert(response.msg);
                                placeholder.src = response.url;
                                //document.getElementById('profileImgUrl').value = response.name;
                                var j = jQuery.noConflict();
                                j("#chat_popup").load(window.location.href + " #chat_popup" );
                            }
                        }
                    });
                }
            }
            function validatePhonenumber(inputtxt){
                var phoneno = /^[\+]?[0-9]{1,2}?[-\s\.]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im;
                if((inputtxt.value.match(phoneno))){
                    return true;
                }else{
                    alert("Invalid phone number");
                    return false;
                }
            }
        </script>
    </body>
</html>