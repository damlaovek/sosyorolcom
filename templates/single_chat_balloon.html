<style>
    .chat_balloon:not(:first-child){margin-top:20px;}
    .chat_balloon_msg img{width:200px;height:200px; margin: 5px 0;}
    .chat_balloon_msg{
        max-width:300px;
        padding:10px;
        min-height:20px;
        line-height:20px;
        /* These are technically the same, but use both */
        overflow-wrap: break-word;
        word-wrap: break-word;

        -ms-word-break: break-all;
        /* This is the dangerous one in WebKit, as it breaks things wherever */
        word-break: break-all;
        /* Instead use this non-standard one: */
        word-break: break-word;

        /* Adds a hyphen where the word breaks, if supported (No Blink) */
        -ms-hyphens: auto;
        -moz-hyphens: auto;
        -webkit-hyphens: auto;
        hyphens: auto;
    }
    .chat_balloon_msg img[data-type="sosmoji"] {
        width:50px;
        height:50px;
        margin: 5px 0;
    }
    .media-popup img{height: 100%; width:100%; object-fit:contain; margin:auto;}
</style>
<div class="bsbb full-width inline-block chat_balloon">
    {% if chat.sender.ID == current_uid %}
        <div class="right inline-block">
            <img src="{{chat.sender.avatar_url}}" class="sqr40 rounded right">
            <div class="right mr10 bcgrayish br10 chat_balloon_msg" style="text-align:right;">
                <div class="cb full-width fwbold" style="text-align:right;">u/{{chat.sender.user_login}}</div>
                <div class="full-width">{% autoescape off %}{{chat.msg}}{% endautoescape %}</div>
                <div class="full-width fs13 cg2" style="text-align:right;">{{chat.date}}</div>
            </div>
        </div>
    {% else %}
    <div class="left inline-block">
        <img src="{{chat.sender.avatar_url}}" class="sqr40 rounded left">
        <div class="left ml10 bcba br10 chat_balloon_msg">
            <div class="cb full-width fwbold">u/{{chat.sender.user_login}}</div>
            {% if media %}
                <div class="full-width mediatarget" id="mediatarget_{{chat.ID}}" onclick="document.getElementById('media_{{chat.ID}}').classList.remove('hidden');document.getElementById('chat_popup').style.zIndex='-1';">
            {% else %}
                <div class="full-width">
            {% endif %}
                    {% autoescape off %}{{chat.msg}}{% endautoescape %}
                </div>
            <div class="full-width fs13 cg2" style="text-align:left;">{{chat.date}}</div>
        </div>
    </div>
    {% endif %}
</div>
{% if media %}
<div class="fixed aligntl full oh popup-container hidden media-popup" id="media_{{chat.ID}}">
    <svg style="position:absolute;top:20px;right:20px;cursor:pointer;padding:5px;width:15px;height:15px;z-index:9999;" class="icon hand" onclick="document.getElementById('media_{{chat.ID}}').classList.toggle('hidden');document.getElementById('chat_popup').style.zIndex='999999999';" viewBox="0 0 15 15" version="1.1">
        <g id="surface1">
            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;" d="M 0.132812 14.878906 C 0.222656 14.964844 0.335938 15.011719 0.453125 15.011719 C 0.570312 15.011719 0.683594 14.964844 0.773438 14.878906 L 7.503906 8.144531 L 14.238281 14.878906 C 14.324219 14.964844 14.441406 15.011719 14.558594 15.011719 C 14.675781 15.011719 14.789062 14.964844 14.878906 14.878906 C 15.054688 14.703125 15.054688 14.414062 14.878906 14.238281 L 8.144531 7.503906 L 14.878906 0.773438 C 15.054688 0.597656 15.054688 0.308594 14.878906 0.132812 C 14.703125 -0.0429688 14.414062 -0.0429688 14.238281 0.132812 L 7.503906 6.863281 L 0.773438 0.132812 C 0.597656 -0.0429688 0.308594 -0.0429688 0.132812 0.132812 C -0.0429688 0.308594 -0.0429688 0.597656 0.132812 0.773438 L 6.863281 7.503906 L 0.132812 14.238281 C -0.0429688 14.414062 -0.0429688 14.703125 0.132812 14.878906 Z M 0.132812 14.878906 "/>
        </g>
    </svg>
    <div class="absolute full-width aligntl" style="top:50px; height:calc(100% - 157px);z-index: 99999999999999;">
        {% autoescape off %}{{chat.msg}}{% endautoescape %}
    </div>
</div>
{% endif %}